# 第二章 递归状态估计

于小咸

## 1. 

这道题目与2.4.2 的例题很相似，练习离散贝叶斯滤波的使用。根据题意可知：
$$
\begin{align}
&bel(X_0=broken) &=0.01 \\
&bel(X_0=not\_broken) &= 0.99 \\
&p(Z_t<1|X_t=broken) &= 1 \\
&p(Z_t<1|X_t=not\_broken) &= 1/3
\end{align}
$$
其中 $$Z_t$$ 表示 $$t$$ 时刻距离传感器的测量值，在 $0$ ~ $3m$ 范围内连续取值；$$X_t$$ 表示距离传感器的状态，取值为离散的 $$broken$$ ，$$not\_broken$$。

下面根据贝叶斯滤波算法进行计算，由于这道题中没有对距离传感器进行任何控制，因此贝叶斯滤波的第一步（预测）并不改变系统状态的置信度：

$$
\begin{align}
\bar{bel}(X_t) = bel(X_{t-1})
\end{align}
$$

贝叶斯滤波的第二步（观测），题干中介绍到$Z_t < 1$，于是有以下递推式
$$
\begin{align}
&bel(X_t=broken) &= \eta p(Z_t<1|X_t=broken)\bar{bel}(X_t=broken) \\
&bel(X_t=not\_broken) &= \eta p(Z_t<1|X_t=not\_broken)\bar{bel}(X_t=not\_broken) 
\end{align}
$$

其中 $\eta$ 为归一化因子
$$
\eta = [p(Z_t<1|X_t=broken)\bar{bel}(X_t=broken) + \\ p(Z_t<1|X_t=not\_broken)\bar{bel}(X_t=not\_broken)]^{-1}
$$


对以上5、6、7式代入先验初值1、2进行迭代，即可得到各个时刻距离传感器故障的概率如下

| 时刻 | $bel(X_t=broken|Z_t<1)$ | $bel(X_t=not\_broken|Z_t<1)$ | $\eta$             |
| ---- | ----------------------- | ---------------------------- | ------------------ |
| 0    | 0.01                    | 0.99                         |                    |
| 1    | 0.029411764705882353    | 0.9705882352941176           | 2.941176470588235  |
| 2    | 0.08333333333333333     | 0.9166666666666666           | 2.833333333333333  |
| 3    | 0.2142857142857143      | 0.7857142857142857           | 2.5714285714285716 |
| 4    | 0.45000000000000007     | 0.55                         | 2.1                |
| 5    | 0.7105263157894737      | 0.2894736842105263           | 1.5789473684210524 |
| 6    | 0.8804347826086958      | 0.11956521739130438          | 1.2391304347826089 |
| 7    | 0.9566929133858267      | 0.043307086614173235         | 1.0866141732283463 |
| 8    | 0.9851351351351351      | 0.014864864864864866         | 1.0297297297297296 |
| 9    | 0.9949954504094631      | 0.0050045495905368526        | 1.0100090991810737 |
| 10   | 0.9983262325015215      | 0.0016737674984783934        | 1.0033475349969567 |

最后推导公式：
$$
\begin{align}
\begin{array}
\ bel(X_t=broken) &= {\eta}_t\times1\times bel(X_{t-1}=broken) \\
&= {\eta}_t{\eta}_{t-1}\times1\times bel(X_{t-2}=broken) \\
&=\prod_{i=0}^n {\eta}_i bel(X_0=broken)
\end{array}
\\
\begin{array}
\ bel(X_t=not\_broken) &= {\eta}_t\times \frac{1}{3} \times bel(X_{t-1}=not\_broken) \\
&= {\eta}_t{\eta}_{t-1}\times \frac{1}{3} \times bel(X_{t-2}=broken) \\
&=\prod_{i=0}^n {\eta}_i \times \frac{1}{3^n} \times bel(X_0=not\_broken)
\end{array}
\end{align}
$$
其中 $\prod_{i=0}^n {\eta}_i$ 满足归一化要求，即
$$
\prod_{i=0}^n {\eta}_i = [bel(X_0=broken) + \frac{1}{3^n} \times bel(X_0=not\_broken)]^{-1}
$$
因此，传感器失效的概率为
$$
bel(X_t=broken) = \frac{bel(X_0=broken)}{bel(X_0=broken) + \frac{1}{3^n} \times bel(X_0=not\_broken)}
$$

## 2. 已知天气状态转移矩阵

|              | 晴（明天） | 多云 | 雨   |
| ------------ | ---------- | ---- | ---- |
| 晴（今天）   | 0.8        | 0.2  | 0    |
| 多云（今天） | 0.4        | 0.4  | 0.2  |
| 雨（今天）   | 0.2        | 0.6  | 0.2  |

### a) 第一天是晴天，求接下来三天是多云、多云、雨的概率

可以通过贝叶斯公式得到
$$
\begin{align}
\begin{array}
P(X_4=rainy) &= P(X_4=rainy|X_3=cloudy)P(X_3=cloudy) \\
&= P(X_4=rainy|X_3=cloudy)P(X_3=cloudy|X_2=cloudy)\\
& P(X_2=cloudy|X_1=sunny)P(X_1=sunny) \\
&= 0.2 \times 0.4 \times 0.2 \\
&= 0.016
\end{array}
\end{align}
$$

### b)编程随机产生天气序列的仿真器

### c)计算平稳分布

首先需要知道平稳分布的定义，根据[维基百科](<https://en.wikipedia.org/wiki/Markov_chain#Steady-state_analysis_and_limiting_distributions>)的介绍，平稳分布是指不随时间变化的状态分布，即
$$
\lim\limits_{n \to \infty} {X_n}=\lim\limits_{n \to \infty}{A^nX_0}
$$
使用b) 中设计的随机天气序列仿真器，在天气序列足够长时，天气出现的频率就是平稳分布的概率，计算得到
$$
P_{static}=[0.6430726, 0.2855164, 0.071411]^T
$$

### d)通过公式计算平稳分布

根据平稳分布的定义，我们需要求的其实是状态转移矩阵的特征值1对应的特征向量
$$
Ax=x
$$
这里我们采用偷懒的方法，使用[矩阵特征向量在线计算工具](<https://zs.symbolab.com/solver/matrix-eigenvectors-calculator>)，计算得到特征向量为
$$
[9, 4, 1]^T
$$
对该向量进行概率归一化得到
$$
P_{static}=[9/14, 2/7, 1/14]^T
$$

### f) 计算给定今天天气时，昨天天气的概率表

需要计算以下条件概率
$$
P(X_{t-1}=i|X_t=j)=\frac{P(X_{t}=j|X_{t-1}=i)P(X_{t-1}=i)}{P(X_{t}=j)} \\
P(X_{t}=j)=\sum_{i}^3 P(X_{t}=j|X_{t-1}=i)P(X_{t-1}=i)
$$
其中$$P(X_{t-1}=i)$$作为先验概率，由平稳分布给出，从而计算得出概率表

|            | 晴（今天） | 多云 | 雨   |
| ---------- | ---------- | ---- | ---- |
| 晴（昨天） | 0.8        | 0.45 | 0    |
| 多云       | $$8/45$$   | 0.4  | 0.8  |
| 雨         | $$1/45$$   | 0.15 | 0.2  |



### g) 如果天气状态转移概率与季节相关，这个过程还满足马尔科夫特性吗

不满足。马尔科夫特性要求，当前时刻的系统状态只与上一时刻的系统状态有关，与其他变量无关。如果引入季节这一变量，就会破坏马尔科夫特性。但是在一个季节内，状态转移矩阵不发生变化，该过程依然保持马尔科夫特性。

## 3.

## 4.

## 5.

## 6.